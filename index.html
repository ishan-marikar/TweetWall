<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TweetHose</title>

    <!-- APPLE STUFF -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- STYLES AND FONTS -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,100' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/styles.css">

</head>
<body>
    
    <!-- THE ACTUAL PLACEHOLDER -->
    <div class="container"></div>

    <!-- TEMPLATE -->
    <script id="tweet-template" type="text/x-handlebars-template">
        <div class="tweet">
            <div id="back-image" style="background-image: url({{{image}}});"></div>
            <div class="profile-picture"> 
                <img class="image" src="{{{avatar}}}">
            </div>
            <a href="http://twitter.com/{{user}}" target="_blank">
                <div class="tweet-link"> {{{user}}} </div>
            </a>
            <div class="status"> {{{status}}} </div>
            <img class="image" src="{{{image}}}">
        </div>    
    </script>

    <!-- REQUIRED LIBRARIES -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.js"></script>

    <!-- HERE BE DRAGONS -->
    <script type="text/javascript">

    // Maybe for a later date.

    /*(function($) {
        var compiled = {};
        $.fn.handlebars = function(template, data) {
          if (template instanceof jQuery) {
            template = $(template).html();
          }
 
          compiled[template] = Handlebars.compile(template);
          this.html(compiled[template](data));
        };
    })(jQuery);

    $('.container').handlebars($('#tweet-template'), context);
    */

    function render(context){
        var theTemplateScript = $("#tweet-template").html();
        var theTemplate = Handlebars.compile(theTemplateScript);
        var theCompiledHtml = theTemplate(context);
        return theCompiledHtml
    }

    $(function () {

        var socket = io.connect();
        socket.on('stream', function(tweet, user, avatar, media) {
            console.log(tweet + user + avatar + media) // DEBUG

            var context={
              "avatar": avatar,
              "status": tweet,
              "user"  : user,
              "image" : media
            };

            $('.container').append(render(context));
        });
    });

    </script>
    
</body>
</html>